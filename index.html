<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 10 Study Companion</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .slide-in { animation: slideIn 0.3s ease-out forwards; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .checkbox-wrapper input:checked + div {
            background-color: #10b981;
            border-color: #10b981;
        }
        .checkbox-wrapper input:checked + div svg {
            display: block;
        }
        
        /* Pomodoro Ring Animation */
        .timer-ring { transition: stroke-dashoffset 1s linear; }
    </style>
</head>
<body class="text-slate-800 h-screen flex overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-20 md:w-64 bg-white border-r border-gray-200 flex-shrink-0 flex flex-col justify-between transition-all duration-300 z-20">
        <div>
            <div class="h-16 flex items-center justify-center md:justify-start md:px-6 border-b border-gray-100">
                <i data-lucide="graduation-cap" class="w-8 h-8 text-indigo-600"></i>
                <span class="ml-3 font-bold text-xl hidden md:block text-indigo-900">StudyMaster</span>
            </div>

            <nav class="mt-6 flex flex-col gap-2 px-2">
                <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-item flex items-center p-3 rounded-lg text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors active-nav">
                    <i data-lucide="layout-dashboard" class="w-6 h-6"></i>
                    <span class="ml-3 font-medium hidden md:block">Dashboard</span>
                </button>
                <button onclick="switchTab('syllabus')" id="nav-syllabus" class="nav-item flex items-center p-3 rounded-lg text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                    <i data-lucide="book-open" class="w-6 h-6"></i>
                    <span class="ml-3 font-medium hidden md:block">Syllabus Manager</span>
                </button>
                <button onclick="switchTab('timetable')" id="nav-timetable" class="nav-item flex items-center p-3 rounded-lg text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                    <i data-lucide="calendar" class="w-6 h-6"></i>
                    <span class="ml-3 font-medium hidden md:block">Timetable</span>
                </button>
                <button onclick="switchTab('pomodoro')" id="nav-pomodoro" class="nav-item flex items-center p-3 rounded-lg text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                    <i data-lucide="timer" class="w-6 h-6"></i>
                    <span class="ml-3 font-medium hidden md:block">Focus Timer</span>
                </button>
            </nav>
        </div>
        
        <div class="p-4 border-t border-gray-100 hidden md:block">
            <div class="bg-indigo-50 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-indigo-900">Exam Countdown</h4>
                <div class="mt-2 text-xs text-indigo-700">Keep pushing! Consitency is key.</div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto relative">
        <!-- Header -->
        <header class="h-16 bg-white/80 backdrop-blur sticky top-0 z-10 border-b border-gray-200 px-8 flex items-center justify-between">
            <h2 id="page-title" class="text-xl font-bold text-slate-800">Dashboard</h2>
            <button onclick="resetData()" class="text-xs text-red-500 hover:text-red-700 underline">Reset All Data</button>
        </header>

        <div class="p-6 md:p-8 max-w-7xl mx-auto pb-20">
            
            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="view-section slide-in">
                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm text-gray-500">Total Progress</p>
                                <h3 class="text-3xl font-bold text-slate-800 mt-1" id="total-progress">0%</h3>
                            </div>
                            <div class="p-2 bg-green-100 text-green-600 rounded-lg">
                                <i data-lucide="trending-up" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
                            <div id="total-progress-bar" class="bg-green-500 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm text-gray-500">Important Topics</p>
                                <h3 class="text-3xl font-bold text-slate-800 mt-1" id="imp-topics-count">0</h3>
                            </div>
                            <div class="p-2 bg-amber-100 text-amber-600 rounded-lg">
                                <i data-lucide="star" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-4">Topics marked as high priority</p>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm text-gray-500">Chapters Left</p>
                                <h3 class="text-3xl font-bold text-slate-800 mt-1" id="chapters-left">0</h3>
                            </div>
                            <div class="p-2 bg-indigo-100 text-indigo-600 rounded-lg">
                                <i data-lucide="book" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-4">Remaining to complete</p>
                    </div>
                </div>

                <!-- Subject Breakdown -->
                <h3 class="text-lg font-bold text-slate-800 mb-4">Subject Breakdown</h3>
                <div id="dashboard-subjects" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Injected by JS -->
                </div>
            </div>

            <!-- VIEW: SYLLABUS MANAGER -->
            <div id="view-syllabus" class="view-section hidden slide-in">
                <div class="flex justify-between items-center mb-6">
                    <p class="text-slate-500">Manage your subjects, chapters, and track completion.</p>
                    <button onclick="openModal('subject-modal')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-all shadow-lg shadow-indigo-200">
                        <i data-lucide="plus" class="w-4 h-4"></i> Add Subject
                    </button>
                </div>

                <div id="syllabus-container" class="space-y-6">
                    <!-- Subjects injected here -->
                </div>
            </div>

            <!-- VIEW: TIMETABLE -->
            <div id="view-timetable" class="view-section hidden slide-in">
                <div class="flex justify-between items-center mb-6">
                    <p class="text-slate-500">Weekly schedule planner.</p>
                    <button onclick="openModal('timetable-modal')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i> Add Class/Study Slot
                    </button>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 border-b border-gray-200">
                                    <th class="p-4 font-semibold text-gray-600 w-32">Day</th>
                                    <th class="p-4 font-semibold text-gray-600">Schedule</th>
                                </tr>
                            </thead>
                            <tbody id="timetable-body">
                                <!-- JS Injection -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: POMODORO -->
            <div id="view-pomodoro" class="view-section hidden slide-in h-full flex flex-col items-center justify-center pt-10">
                <div class="bg-white p-8 md:p-12 rounded-3xl shadow-xl text-center max-w-md w-full border border-gray-100 relative overflow-hidden">
                    
                    <div class="flex justify-center gap-2 mb-8 bg-gray-100 p-1 rounded-full">
                        <button onclick="setTimerMode('work')" id="mode-work" class="flex-1 py-2 px-4 rounded-full text-sm font-medium bg-white shadow-sm text-indigo-600 transition-all">Work</button>
                        <button onclick="setTimerMode('short')" id="mode-short" class="flex-1 py-2 px-4 rounded-full text-sm font-medium text-gray-500 hover:text-gray-700 transition-all">Short Break</button>
                        <button onclick="setTimerMode('long')" id="mode-long" class="flex-1 py-2 px-4 rounded-full text-sm font-medium text-gray-500 hover:text-gray-700 transition-all">Long Break</button>
                    </div>

                    <div class="relative w-64 h-64 mx-auto mb-8 flex items-center justify-center">
                        <!-- SVG Circle Progress -->
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="128" cy="128" r="120" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-100" />
                            <circle id="timer-circle" cx="128" cy="128" r="120" stroke="currentColor" stroke-width="8" fill="transparent" class="text-indigo-500 timer-ring" stroke-dasharray="754" stroke-dashoffset="0" stroke-linecap="round" />
                        </svg>
                        <div class="absolute top-0 left-0 w-full h-full flex flex-col items-center justify-center">
                            <span id="timer-display" class="text-6xl font-bold text-slate-800 tracking-tighter">25:00</span>
                            <span id="timer-status" class="text-gray-400 text-sm mt-2 uppercase tracking-widest font-semibold">Focus</span>
                        </div>
                    </div>

                    <div class="flex items-center justify-center gap-4">
                        <button onclick="toggleTimer()" id="btn-toggle-timer" class="bg-indigo-600 hover:bg-indigo-700 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-lg shadow-indigo-200 transition-transform active:scale-95">
                            <i data-lucide="play" class="w-8 h-8 ml-1"></i>
                        </button>
                        <button onclick="resetTimer()" class="bg-gray-100 hover:bg-gray-200 text-gray-600 w-12 h-12 rounded-full flex items-center justify-center transition-colors">
                            <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- MODALS -->

    <!-- Add Subject Modal -->
    <div id="subject-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white rounded-xl p-6 w-full max-w-md shadow-2xl transform transition-all">
            <h3 class="text-lg font-bold mb-4">Add New Subject</h3>
            <input type="text" id="new-subject-name" placeholder="e.g., Mathematics" class="w-full border border-gray-300 rounded-lg p-3 mb-4 focus:ring-2 focus:ring-indigo-500 outline-none">
            <div class="flex justify-end gap-3">
                <button onclick="closeModal('subject-modal')" class="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg">Cancel</button>
                <button onclick="addSubject()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Add Subject</button>
            </div>
        </div>
    </div>

    <!-- Add Chapter Modal -->
    <div id="chapter-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white rounded-xl p-6 w-full max-w-md shadow-2xl">
            <h3 class="text-lg font-bold mb-4">Add Chapter</h3>
            <input type="hidden" id="active-subject-id">
            <input type="text" id="new-chapter-name" placeholder="Chapter Name (e.g. Real Numbers)" class="w-full border border-gray-300 rounded-lg p-3 mb-4 focus:ring-2 focus:ring-indigo-500 outline-none">
            
            <label class="flex items-center gap-2 mb-4 cursor-pointer">
                <input type="checkbox" id="new-chapter-imp" class="w-5 h-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500">
                <span class="text-gray-700">Mark as High Priority / Important</span>
            </label>

            <div class="flex justify-end gap-3">
                <button onclick="closeModal('chapter-modal')" class="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg">Cancel</button>
                <button onclick="addChapter()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Add Chapter</button>
            </div>
        </div>
    </div>

    <!-- Add Timetable Slot Modal -->
    <div id="timetable-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white rounded-xl p-6 w-full max-w-md shadow-2xl">
            <h3 class="text-lg font-bold mb-4">Add Schedule Slot</h3>
            
            <label class="block text-sm font-medium text-gray-700 mb-1">Day</label>
            <select id="slot-day" class="w-full border border-gray-300 rounded-lg p-3 mb-3 bg-white">
                <option value="Monday">Monday</option>
                <option value="Tuesday">Tuesday</option>
                <option value="Wednesday">Wednesday</option>
                <option value="Thursday">Thursday</option>
                <option value="Friday">Friday</option>
                <option value="Saturday">Saturday</option>
                <option value="Sunday">Sunday</option>
            </select>

            <label class="block text-sm font-medium text-gray-700 mb-1">Time</label>
            <input type="time" id="slot-time" class="w-full border border-gray-300 rounded-lg p-3 mb-3">

            <label class="block text-sm font-medium text-gray-700 mb-1">Activity/Subject</label>
            <input type="text" id="slot-activity" placeholder="e.g. Math Study, Science Class" class="w-full border border-gray-300 rounded-lg p-3 mb-4">

            <div class="flex justify-end gap-3">
                <button onclick="closeModal('timetable-modal')" class="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg">Cancel</button>
                <button onclick="addTimetableSlot()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Add to Schedule</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 transform translate-y-20 opacity-0 transition-all duration-300 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 z-50">
        <i data-lucide="check-circle" class="w-5 h-5 text-green-400"></i>
        <span id="toast-msg">Action Successful</span>
    </div>

    <script>
        // --- DATA STORE ---
        const DEFAULT_DATA = {
            subjects: [
                {
                    id: 1715001, name: "Mathematics", chapters: [
                        { id: 101, name: "Real Numbers", important: false, completed: true, notes: "Review Euclid's Division Lemma" },
                        { id: 102, name: "Polynomials", important: true, completed: false, notes: "" },
                        { id: 103, name: "Quadratic Equations", important: true, completed: false, notes: "" }
                    ]
                },
                {
                    id: 1715002, name: "Science", chapters: [
                        { id: 201, name: "Chemical Reactions", important: true, completed: false, notes: "" },
                        { id: 202, name: "Life Processes", important: false, completed: false, notes: "" }
                    ]
                }
            ],
            timetable: [
                { day: "Monday", time: "09:00", activity: "Math Practice" },
                { day: "Monday", time: "11:00", activity: "Science Revision" },
                { day: "Wednesday", time: "18:00", activity: "History Reading" }
            ]
        };

        let appData = JSON.parse(localStorage.getItem('studyManagerData')) || DEFAULT_DATA;

        // --- INIT ---
        function init() {
            lucide.createIcons();
            renderDashboard();
            renderSyllabus();
            renderTimetable();
            checkReminders();
        }

        function saveData() {
            localStorage.setItem('studyManagerData', JSON.stringify(appData));
            renderDashboard(); // Updates stats dynamically
        }

        function resetData() {
            if(confirm("Are you sure? This will clear all your progress.")) {
                appData = DEFAULT_DATA;
                saveData();
                location.reload();
            }
        }

        // --- NAVIGATION ---
        function switchTab(tabId) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            // Show selected
            document.getElementById(`view-${tabId}`).classList.remove('hidden');
            
            // Update Nav Styling
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('bg-indigo-50', 'text-indigo-600', 'active-nav');
                el.classList.add('text-slate-600');
            });
            
            const activeNav = document.getElementById(`nav-${tabId}`);
            activeNav.classList.add('bg-indigo-50', 'text-indigo-600', 'active-nav');
            activeNav.classList.remove('text-slate-600');

            // Update Title
            const titles = { 'dashboard': 'Dashboard', 'syllabus': 'Syllabus Manager', 'timetable': 'Timetable', 'pomodoro': 'Focus Timer' };
            document.getElementById('page-title').innerText = titles[tabId];

            // Init Icons for new view
            lucide.createIcons();
        }

        // --- DASHBOARD RENDER ---
        function renderDashboard() {
            let totalChapters = 0;
            let completedChapters = 0;
            let importantCount = 0;

            const subjectsContainer = document.getElementById('dashboard-subjects');
            subjectsContainer.innerHTML = '';

            appData.subjects.forEach(sub => {
                const subTotal = sub.chapters.length;
                const subCompleted = sub.chapters.filter(c => c.completed).length;
                const subImp = sub.chapters.filter(c => c.important).length;
                
                totalChapters += subTotal;
                completedChapters += subCompleted;
                importantCount += subImp;

                const pct = subTotal === 0 ? 0 : Math.round((subCompleted / subTotal) * 100);

                const card = document.createElement('div');
                card.className = 'bg-white p-5 rounded-xl shadow-sm border border-gray-100';
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-slate-700">${sub.name}</h4>
                        <span class="text-xs font-semibold px-2 py-1 bg-gray-100 rounded text-gray-600">${subCompleted}/${subTotal}</span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-2 mb-2">
                        <div class="bg-indigo-500 h-2 rounded-full transition-all duration-500" style="width: ${pct}%"></div>
                    </div>
                    <p class="text-xs text-gray-400">${pct}% Complete</p>
                `;
                subjectsContainer.appendChild(card);
            });

            // Global Stats
            const globalPct = totalChapters === 0 ? 0 : Math.round((completedChapters / totalChapters) * 100);
            document.getElementById('total-progress').innerText = `${globalPct}%`;
            document.getElementById('total-progress-bar').style.width = `${globalPct}%`;
            document.getElementById('imp-topics-count').innerText = importantCount;
            document.getElementById('chapters-left').innerText = totalChapters - completedChapters;
        }

        // --- SYLLABUS MANAGER RENDER ---
        function renderSyllabus() {
            const container = document.getElementById('syllabus-container');
            container.innerHTML = '';

            appData.subjects.forEach(sub => {
                const subDiv = document.createElement('div');
                subDiv.className = 'bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden';
                
                // Header
                const progress = sub.chapters.length ? Math.round((sub.chapters.filter(c => c.completed).length / sub.chapters.length) * 100) : 0;
                
                let chaptersHtml = '';
                sub.chapters.forEach(ch => {
                    chaptersHtml += `
                        <div class="flex items-start justify-between p-4 border-b border-gray-50 hover:bg-gray-50 transition-colors group">
                            <div class="flex items-start gap-3 flex-1">
                                <label class="checkbox-wrapper relative inline-flex items-center cursor-pointer mt-1">
                                    <input type="checkbox" class="sr-only" onchange="toggleChapter(${sub.id}, ${ch.id})" ${ch.completed ? 'checked' : ''}>
                                    <div class="w-5 h-5 border-2 border-gray-300 rounded flex items-center justify-center transition-colors bg-white">
                                        <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                                    </div>
                                </label>
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <span class="${ch.completed ? 'line-through text-gray-400' : 'text-slate-700 font-medium'}">${ch.name}</span>
                                        ${ch.important ? '<i data-lucide="star" class="w-4 h-4 text-amber-500 fill-current"></i>' : ''}
                                    </div>
                                    <input type="text" 
                                           placeholder="Add key points/notes..." 
                                           class="mt-1 text-xs w-full bg-transparent border-none text-gray-500 focus:ring-0 p-0 placeholder-gray-300" 
                                           value="${ch.notes || ''}"
                                           onchange="updateNote(${sub.id}, ${ch.id}, this.value)">
                                </div>
                            </div>
                            <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="deleteChapter(${sub.id}, ${ch.id})" class="text-red-400 hover:text-red-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                            </div>
                        </div>
                    `;
                });

                subDiv.innerHTML = `
                    <div class="bg-gray-50 p-4 border-b border-gray-200 flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-lg text-indigo-900">${sub.name}</h3>
                            <div class="w-32 bg-gray-200 rounded-full h-1.5 mt-1">
                                <div class="bg-green-500 h-1.5 rounded-full" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="prepareAddChapter(${sub.id})" class="text-xs bg-white border border-gray-300 px-3 py-1 rounded hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                                + Add Chapter
                            </button>
                             <button onclick="deleteSubject(${sub.id})" class="text-gray-400 hover:text-red-500 p-1"><i data-lucide="trash" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                    <div class="divide-y divide-gray-100">
                        ${chaptersHtml.length > 0 ? chaptersHtml : '<div class="p-4 text-sm text-gray-400 italic text-center">No chapters added yet.</div>'}
                    </div>
                `;
                container.appendChild(subDiv);
            });
            lucide.createIcons();
        }

        // --- SYLLABUS ACTIONS ---
        function prepareAddChapter(subId) {
            document.getElementById('active-subject-id').value = subId;
            document.getElementById('new-chapter-name').value = '';
            document.getElementById('new-chapter-imp').checked = false;
            openModal('chapter-modal');
        }

        function addSubject() {
            const name = document.getElementById('new-subject-name').value;
            if(!name) return;
            appData.subjects.push({ id: Date.now(), name: name, chapters: [] });
            saveData();
            renderSyllabus();
            closeModal('subject-modal');
            showToast('Subject Added');
        }

        function deleteSubject(id) {
            if(confirm("Delete entire subject?")) {
                appData.subjects = appData.subjects.filter(s => s.id !== id);
                saveData();
                renderSyllabus();
            }
        }

        function addChapter() {
            const subId = parseInt(document.getElementById('active-subject-id').value);
            const name = document.getElementById('new-chapter-name').value;
            const isImp = document.getElementById('new-chapter-imp').checked;
            
            if(!name) return;

            const subject = appData.subjects.find(s => s.id === subId);
            if(subject) {
                subject.chapters.push({
                    id: Date.now(),
                    name: name,
                    important: isImp,
                    completed: false,
                    notes: ""
                });
                saveData();
                renderSyllabus();
                closeModal('chapter-modal');
                showToast('Chapter Added');
            }
        }

        function toggleChapter(subId, chId) {
            const sub = appData.subjects.find(s => s.id === subId);
            const ch = sub.chapters.find(c => c.id === chId);
            ch.completed = !ch.completed;
            saveData();
            renderSyllabus(); // Re-render to update progress bars
        }

        function updateNote(subId, chId, note) {
            const sub = appData.subjects.find(s => s.id === subId);
            const ch = sub.chapters.find(c => c.id === chId);
            ch.notes = note;
            saveData();
        }

        function deleteChapter(subId, chId) {
            const sub = appData.subjects.find(s => s.id === subId);
            sub.chapters = sub.chapters.filter(c => c.id !== chId);
            saveData();
            renderSyllabus();
        }

        // --- TIMETABLE LOGIC ---
        function renderTimetable() {
            const tbody = document.getElementById('timetable-body');
            tbody.innerHTML = '';
            
            const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
            
            days.forEach(day => {
                const slots = appData.timetable.filter(t => t.day === day).sort((a,b) => a.time.localeCompare(b.time));
                
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 last:border-none hover:bg-gray-50';
                
                // Format slots
                let slotsHtml = '';
                if(slots.length > 0) {
                    slotsHtml = `<div class="flex flex-wrap gap-2">`;
                    slots.forEach(slot => {
                        slotsHtml += `
                            <div class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded text-sm flex items-center gap-2 group">
                                <b>${slot.time}</b> ${slot.activity}
                                <button onclick="removeTimetableSlot(${appData.timetable.indexOf(slot)})" class="opacity-0 group-hover:opacity-100 text-indigo-400 hover:text-indigo-900"><i data-lucide="x" class="w-3 h-3"></i></button>
                            </div>
                        `;
                    });
                    slotsHtml += `</div>`;
                } else {
                    slotsHtml = `<span class="text-gray-300 text-sm italic">Free Day</span>`;
                }

                row.innerHTML = `
                    <td class="p-4 font-medium text-slate-700 align-top">${day}</td>
                    <td class="p-4 align-top">${slotsHtml}</td>
                `;
                tbody.appendChild(row);
            });
            lucide.createIcons();
        }

        function addTimetableSlot() {
            const day = document.getElementById('slot-day').value;
            const time = document.getElementById('slot-time').value;
            const activity = document.getElementById('slot-activity').value;

            if(!day || !time || !activity) return;

            appData.timetable.push({ day, time, activity });
            saveData();
            renderTimetable();
            closeModal('timetable-modal');
            showToast('Added to Schedule');
        }

        function removeTimetableSlot(index) {
            appData.timetable.splice(index, 1);
            saveData();
            renderTimetable();
        }

        // --- POMODORO LOGIC ---
        let timerInterval;
        let timeLeft = 25 * 60;
        let isRunning = false;
        const circle = document.getElementById('timer-circle');
        const circumference = 2 * Math.PI * 120; 

        function setTimerMode(mode) {
            clearInterval(timerInterval);
            isRunning = false;
            updateTimerBtnIcon();
            
            // UI Updates
            ['work', 'short', 'long'].forEach(m => {
                const btn = document.getElementById(`mode-${m}`);
                if (m === mode) {
                    btn.className = "flex-1 py-2 px-4 rounded-full text-sm font-medium bg-white shadow-sm text-indigo-600 transition-all";
                } else {
                    btn.className = "flex-1 py-2 px-4 rounded-full text-sm font-medium text-gray-500 hover:text-gray-700 transition-all";
                }
            });

            const statusText = document.getElementById('timer-status');
            
            if (mode === 'work') {
                timeLeft = 25 * 60;
                statusText.innerText = "Focus Time";
                circle.classList.add('text-indigo-500');
                circle.classList.remove('text-green-500', 'text-blue-500');
            } else if (mode === 'short') {
                timeLeft = 5 * 60;
                statusText.innerText = "Short Break";
                circle.classList.add('text-green-500');
                circle.classList.remove('text-indigo-500', 'text-blue-500');
            } else {
                timeLeft = 15 * 60;
                statusText.innerText = "Long Break";
                circle.classList.add('text-blue-500');
                circle.classList.remove('text-indigo-500', 'text-green-500');
            }
            
            updateTimerDisplay();
        }

        function toggleTimer() {
            if (isRunning) {
                clearInterval(timerInterval);
                isRunning = false;
            } else {
                isRunning = true;
                timerInterval = setInterval(() => {
                    if (timeLeft > 0) {
                        timeLeft--;
                        updateTimerDisplay();
                    } else {
                        clearInterval(timerInterval);
                        isRunning = false;
                        showToast("Timer Finished!");
                        let audio = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');
                        audio.play();
                    }
                }, 1000);
            }
            updateTimerBtnIcon();
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            setTimerMode('work'); // Default back to work
        }

        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const s = (timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').innerText = `${m}:${s}`;
            
            // Circle progress
            // Max time depends on current mode but for simplicity handled by visual reset
            // Simple visual progress:
            // Note: exact pct calculation requires tracking totalTime of mode
        }

        function updateTimerBtnIcon() {
            const btn = document.getElementById('btn-toggle-timer');
            btn.innerHTML = isRunning 
                ? `<i data-lucide="pause" class="w-8 h-8 fill-current"></i>` 
                : `<i data-lucide="play" class="w-8 h-8 ml-1 fill-current"></i>`;
            lucide.createIcons();
        }

        // --- UTILS ---
        function openModal(id) {
            document.getElementById(id).classList.remove('hidden');
            document.getElementById(id).classList.add('flex');
        }
        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
            document.getElementById(id).classList.remove('flex');
        }
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // Simple Reminder check (runs on load)
        function checkReminders() {
            // In a real app, this would run every minute
            const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });
            const nowHour = new Date().getHours();
            
            const tasks = appData.timetable.filter(t => t.day === today);
            if(tasks.length > 0) {
                // Just a visual indicator logic here
                console.log(`You have ${tasks.length} tasks today.`);
            }
        }

        // Initialize App
        init();

    </script>
</body>
</html>
